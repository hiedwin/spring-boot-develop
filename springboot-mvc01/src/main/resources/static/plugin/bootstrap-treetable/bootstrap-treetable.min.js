/**
 * bootstrap-treetable
 * v1.0.10-beta
 * @author Edwin
 */
(function($){"use strict";var BootstrapTreeTable=function(el,options){this.options=options;this.$el=$(el);this.$el_=this.$el.clone();this.$headerBox=null;this.$leftBox=null;this.data_list=null;this.data_obj=null;this.hiddenColumns=[];this.lastAjaxParams=null;this.hasSelectItem=false;this.leftFixedColumns=[];this.noFixedColumns=[];this.expandColumnIsFixed=false;this.hasFixedColumn=false;this.selectedDataIds=[];this.expandColumnField=null;this.init()};BootstrapTreeTable.prototype.init=function(parms){this.initOptions();this.initContainer();this.initToolbar();this.initHeader();this.initBody();this.initServer(parms)};BootstrapTreeTable.prototype.initOptions=function(){var self=this;$.each(self.options.columns,function(i,column){column=$.extend({},BootstrapTreeTable.COLUMN_DEFAULTS,column);if(column.width){column.width+=(column.width.indexOf("%")==-1&&column.width.indexOf("px")==-1)?"px":""}if(!(column.checkbox||column.radio)){if(column.fixed){if(column.fixed=="left"||column.fixed==true){self.leftFixedColumns.push(column)}if(self.options.expandColumn==i){self.expandColumnIsFixed=true}}else{if(!(typeof column.visible=="undefined"||column.visible==true)){self.hiddenColumns.push(column.field)}self.noFixedColumns.push(column)}}else{self.hasSelectItem=true;self.leftFixedColumns.push(column)}if(self.options.expandColumn==i){self.expandColumnField=column.field}});if(self.leftFixedColumns.length==1){self.noFixedColumns.unshift(self.leftFixedColumns[0]);self.leftFixedColumns.pop()}else{self.hasFixedColumn=true}};BootstrapTreeTable.prototype.initContainer=function(){var self=this;var $container=$("<div class='bootstrap-tree-table'></div>");var $treetable=$("<div class='treetable-box'></div>");var $bodyBox=$("<div class='treetable-body-box'></div>");self.$el.before($container);$container.append($treetable);$treetable.append($bodyBox);$bodyBox.append(self.$el);self.$el.addClass("table treetable-table");if(self.options.striped){self.$el.addClass('table-striped')}if(self.options.bordered){$treetable.addClass('treetable-bordered')}if(self.options.condensed){self.$el.addClass('table-condensed')}if(self.options.width){$container.css('width',self.options.width);$treetable.css('width',self.options.width)}if(self.options.height){$bodyBox.css("height",self.options.height)}self.$el.html("")};BootstrapTreeTable.prototype.initToolbar=function(){var self=this;var $toolbar=$("<div class='treetable-bars'></div>");if(self.options.toolbar){$toolbar.append($(self.options.toolbar))}var $rightToolbar=$('<div class="btn-group tool-right">');$toolbar.append($rightToolbar);self.$el.parent().parent().before($toolbar);if(self.options.showRefresh){var $refreshBtn=$('<button class="btn btn-default btn-outline refresh_btn" type="button" aria-label="refresh" title="刷新"><i class="'+self.options.toolRefreshClass+'"></i></button>');$rightToolbar.append($refreshBtn)}if(self.options.showColumns){var $columns_div=$('<div class="btn-group pull-right" title="列"><button type="button" aria-label="columns" class="btn btn-default btn-outline dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="'+self.options.toolColumnsClass+'"></i><span class="caret"></span></button></div>');var $columns_ul=$('<ul class="dropdown-menu dropdown-menu-right columns" role="menu"></ul>');$.each(self.leftFixedColumns,function(i,column){if(!(column.checkbox||column.radio)){var _li=$('<li role="menuitem"><label><input type="checkbox" checked="checked" disabled data-field="'+column.field+'" value="'+column.field+'" > '+column.title+'</label></li>');$columns_ul.append(_li)}});$.each(self.noFixedColumns,function(i,column){if(!(column.checkbox||column.radio)){var _li=$('<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="'+column.field+'" value="'+column.field+'" > '+column.title+'</label></li>');$columns_ul.append(_li)}});$columns_div.append($columns_ul);$rightToolbar.append($columns_div)}};BootstrapTreeTable.prototype.initHiddenColumns=function(){var self=this;$.each(self.hiddenColumns,function(i,field){var _index=$.inArray(field,self.leftFixedColumns);if(!(_index>-1)){self.$el.parent().parent().find("."+field+"_cls").hide();var $input=$(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+field+"']");$input.prop("checked",'')}})};BootstrapTreeTable.prototype.initHeader=function(){var self=this;var $thr=$('<tr></tr>');var _columns=self.leftFixedColumns.concat(self.noFixedColumns);$.each(_columns,function(i,column){var $th;if(i==0&&(column.checkbox||column.radio)){$th=$('<th style="width:36px"></th>')}else{$th=$('<th style="'+((column.width)?('width:'+column.width):'')+'" class="'+column.field+'_cls"></th>')}$th.text(column.title);$thr.append($th)});var $thead=$('<thead class="treetable-thead"></thead>');$thead.append($thr);self.$el.append($thead);self.$headerBox=$("<div class='treetable-fixed treetable-head-box'></div>");var $topTable=$("<table id='"+self.$el.attr("id")+"_header'></table>");self.$headerBox.append($topTable);self.$el.parent().before(self.$headerBox);self.cloneTable(self.$el,$topTable,0,_columns.length-1);self.$el.find('thead th').each(function(index,el){$(el).html("")});self.$el.parent().scroll(function(){var left=self.$el.parent().scrollLeft();self.$headerBox.find("#"+self.$el.attr("id")+"_header").parent().css({"left":-left})})};BootstrapTreeTable.prototype.initBody=function(){var self=this;var $tbody=$('<tbody class="treetable-tbody"></tbody>');self.$el.append($tbody)};BootstrapTreeTable.prototype.initServer=function(parms){var self=this;self.data_list={};self.data_obj={};var $tbody=self.$el.find("tbody");var $loading='<tr><td colspan="'+self.options.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>';$tbody.html($loading);if(self.options.url){$.ajax({type:self.options.type,url:self.options.url,data:parms?parms:self.options.ajaxParams,dataType:"JSON",success:function(data,textStatus,jqXHR){self.renderTable(data);self.trigger('load-success',data);$(window).resize(function(){self.autoReSize()})},error:function(res,textStatus){var _errorMsg='<tr><td colspan="'+self.options.columns.length+'"><div style="display: block;text-align: center;">'+res.responseText+'</div></td></tr>';$tbody.html(_errorMsg);self.trigger('load-error',textStatus,res)}})}else{if(self.options.data){self.renderTable(self.options.data);self.trigger('load-success',self.options.data);$(window).resize(function(){self.autoReSize()})}else{self.trigger('load-error')}}};BootstrapTreeTable.prototype.renderTable=function(data){var self=this;var $tbody=self.$el.find("tbody");$tbody.html("");if(!data||data.length<=0){var _empty='<tr><td colspan="'+self.options.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>';$tbody.html(_empty);return}self.formatData(data);var rootNode=self.data_list["_root_"];if(rootNode){$.each(rootNode,function(i,item){var _child_row_id="row_id_"+i;self.recursionNode(item,1,_child_row_id,"row_root")})}$.each(data,function(i,item){if(!item.isShow){var tr=self.renderRow(item,false,1,"","");$tbody.append(tr)}});self.$el.append($tbody);self.initHiddenColumns();self.frozen();self.autoReSize();self.registerRowEvent();self.registerExpanderEvent();if(self.options.showRefresh){self.registerRefreshBtnClickEvent()}if(self.options.showColumns){self.registerColumnClickEvent()}};BootstrapTreeTable.prototype.autoReSize=function(){var self=this;var $el_thead=self.$el.find("thead");var $header_box_table=self.$headerBox.find("#"+self.$el.attr("id")+"_header");var $header_box_thead=$header_box_table.find("thead");var _width=$el_thead.children(":first").width();if(self.hasScroll(true)){$header_box_table.width(_width+self.getScrollWidth())}else{$header_box_table.width("auto");self.$el.parent().css("border-bottom","0")}$header_box_thead.css("width",_width);self.$el.parent().parent().find(".treetable-body-box").css("margin-top",$header_box_table.height());var left=self.$el.parent().scrollLeft();var top=self.$el.parent().scrollTop();self.$el.parent().parent().find("#"+self.$el.attr("id")+"_header").parent().css({"left":-left});self.$el.parent().parent().find('.treetable-fixed .treetable-body-box').each(function(index,el){$(el).scrollTop(top)})};BootstrapTreeTable.prototype.frozen=function(){var self=this;if(self.$leftBox){self.$leftBox.remove()}var $table=self.$el;var _tableId=$table.attr("id");var $bodyBox=$table.parent();var $tableBox=$bodyBox.parent();var _noNum=self.noFixedColumns.length;var _leftNum=self.leftFixedColumns.length;$table.find("td").attr("noWrap","nowrap");if(self.leftFixedColumns.length>0){self.$leftBox=$("<div class='treetable-fixed treetable-fixed-l'></div>");var $_bodyBox=$("<div></div>");self.mergeAttributes($bodyBox,$_bodyBox);$_bodyBox.addClass("treetable-fixed");var $leftTable=$("<table></table>");self.$leftBox.append($_bodyBox);$_bodyBox.append($leftTable);$tableBox.append(self.$leftBox);self.cloneTable(self.$el,$leftTable,0,_leftNum-1);self.$leftBox.css("left",$tableBox.offset().left);self.$leftBox.css("top",0);$_bodyBox.height($_bodyBox.height()-self.getScrollWidth()-2);var $_headBox=$("<div class='treetable-fixed treetable-head-box'></div>");self.$leftBox.append($_headBox);var $topTable=$("<table></table>");$_headBox.append($topTable);self.cloneTable($tableBox.find("#"+$table.attr("id")+"_header"),$topTable,0,_leftNum-1);$topTable.removeAttr('style');$topTable.find("thead").removeAttr('style');$bodyBox.scroll(function(){var left=$bodyBox.scrollLeft();var top=$bodyBox.scrollTop();$tableBox.find("#"+$table.attr("id")+"_header").parent().css({"left":-left});$tableBox.find('.treetable-fixed .treetable-body-box').each(function(index,el){$(el).scrollTop(top)})})}};BootstrapTreeTable.prototype.cloneTable=function($table,$newTable,iColumnStart,iColumnEnd){var self=this;self.mergeAttributes($table,$newTable);if($table.find("thead")&&$table.find("thead").length>0){var $newThead=$("<thead></thead>");self.mergeAttributes($table.find("thead"),$newThead);$table.find("thead tr").each(function(i,o){var $newTr=$("<tr></tr>");self.mergeAttributes($(o),$newTr);$(o).find("th").each(function(index,el){if(index>=iColumnStart&&index<=iColumnEnd){$newTr.append($(el).clone(true))}});$newThead.append($newTr)});$newTable.append($newThead)}if($table.find("tbody")&&$table.find("tbody").length>0){var $newTbody=$("<tbody></tbody>");self.mergeAttributes($table.find("tbody"),$newTbody);$table.find("tbody tr").each(function(i,o){var $newTr=$("<tr></tr>");self.mergeAttributes($(o),$newTr);$(o).find("td").each(function(index,el){if(index>=iColumnStart&&index<=iColumnEnd){$newTr.append($(el).clone(true))}});$newTbody.append($newTr)});$newTable.append($newTbody)}};BootstrapTreeTable.prototype.mergeAttributes=function($s,$t){var attrs=$s.get(0).attributes;var i=attrs.length-1;for(;i>=0;i--){var name=attrs[i].name;if(name.toLowerCase()==='id'||attrs[i].value==""||attrs[i].value==null||attrs[i].value=="null"){continue}try{$t.attr(name,attrs[i].value)}catch(e){}}};BootstrapTreeTable.prototype.formatData=function(data){var self=this;var _root=self.options.rootIdValue?self.options.rootIdValue:null;$.each(data,function(index,item){item.isShow=false;var _defaultRootFlag=item[self.options.parentId]=='0'||item[self.options.parentId]==0||item[self.options.parentId]==null||item[self.options.parentId]=='';if(!item[self.options.parentId]||(_root?(item[self.options.parentId]==self.options.rootIdValue):_defaultRootFlag)){if(!self.data_list["_root_"]){self.data_list["_root_"]=[]}if(!self.data_obj["id_"+item[self.options.id]]){self.data_list["_root_"].push(item)}}else{if(!self.data_list["_n_"+item[self.options.parentId]]){self.data_list["_n_"+item[self.options.parentId]]=[]}if(!self.data_obj["id_"+item[self.options.id]]){self.data_list["_n_"+item[self.options.parentId]].push(item)}}self.data_obj["id_"+item[self.options.id]]=item})};BootstrapTreeTable.prototype.recursionNode=function(parentNode,lv,row_id,p_id){var self=this;var $tbody=self.$el.find("tbody");var _ls=self.data_list["_n_"+parentNode[self.options.id]];var $tr=self.renderRow(parentNode,_ls?true:false,lv,row_id,p_id);$tbody.append($tr);if(_ls){$.each(_ls,function(i,item){var _child_row_id=row_id+"_"+i;self.recursionNode(item,(lv+1),_child_row_id,row_id)})}};BootstrapTreeTable.prototype.renderRow=function(item,isP,lv,row_id,p_id){var self=this;item.isShow=true;item.row_id=row_id;item.p_id=p_id;item.lv=lv;var $tr=$('<tr rid="'+row_id+'" pid="'+p_id+'" dataid="'+item[self.options.id]+'"></tr>');var _icon=self.options.expanderCollapsedClass;if(self.options.expandAll){$tr.css("display","table");_icon=self.options.expanderExpandedClass}else if(lv==1){$tr.css("display","table");_icon=(self.options.expandFirst)?self.options.expanderExpandedClass:self.options.expanderCollapsedClass}else if(lv==2){if(self.options.expandFirst){$tr.css("display","table")}else{$tr.css("display","none")}_icon=self.options.expanderCollapsedClass}else{$tr.css("display","none");_icon=self.options.expanderCollapsedClass}var _columns=self.leftFixedColumns.concat(self.noFixedColumns);$.each(_columns,function(index,column){if(column.checkbox||column.radio){var $td=$('<td style="text-align:center;width:36px"></td>');var display="";if(null==column.visible||!column.visible){display="display:none"}if(column.radio){var $ipt=$('<input name="select_item" type="radio" value="'+item[self.options.id]+'" style="'+display+'"/>');$td.append($ipt)}if(column.checkbox){var $ipt=$('<input name="select_item" type="checkbox" value="'+item[self.options.id]+'" style="'+display+'"/>');$td.append($ipt)}$tr.append($td)}else{var $td=$('<td name="'+column.field+'" class="'+column.field+'_cls"></td>');if(column.width){$td.css("width",column.width)}if(column.align){$td.css("text-align",column.align)}if(self.expandColumnField==column.field){$td.css("text-align","left")}if(column.valign){$td.css("vertical-align",column.valign)}if(self.options.showTitle){$td.addClass("ellipsis")}if(column.formatter){$td.html(column.formatter.call(self,item[column.field]==null?"":item[column.field],item,index))}else{if(self.options.showTitle){$td.attr("title",item[column.field]==null?"":item[column.field])}$td.text(item[column.field]==null?"":item[column.field])}if(self.expandColumnField==column.field){if(!isP){$td.prepend('<span class="treetable-expander"></span>')}else{$td.prepend('<span class="treetable-expander '+_icon+'"></span>')}for(var int=0;int<(lv-1);int++){$td.prepend('<span class="treetable-indent"></span>')}}$tr.append($td)}});return $tr};BootstrapTreeTable.prototype.hasScroll=function(flag){var self=this;var box=self.$el.parent()[0];if(flag&&box.scrollHeight>box.clientHeight){return true}if((!(flag))&&box.offsetHeight-box.clientHeight>0){return true}return false};BootstrapTreeTable.prototype.getScrollWidth=function(elem){var width=0;if(elem){width=elem.offsetWidth-elem.clientWidth}else{elem=document.createElement('div');elem.style.width='100px';elem.style.height='100px';elem.style.overflowY='scroll';document.body.appendChild(elem);width=elem.offsetWidth-elem.clientWidth;document.body.removeChild(elem)}return width};BootstrapTreeTable.prototype.registerRefreshBtnClickEvent=function(){var self=this;$(".bootstrap-tree-table .treetable-bars .tool-right .refresh_btn").off('click').on('click',function(){self.refresh()})};BootstrapTreeTable.prototype.registerColumnClickEvent=function(){var self=this;$(".bootstrap-tree-table .treetable-bars .columns label input").off('click').on('click',function(){var $this=$(this);if($this.prop('checked')){self.showColumn($(this).val())}else{self.hideColumn($(this).val())}})};BootstrapTreeTable.prototype.registerRowEvent=function(){var self=this;self.$el.parent().parent().find("tbody").find("tr").find("td").off('click dblclick').on('click dblclick',function(e){var $td=$(this),$tr=$td.parent(),item=self.data_obj["id_"+$tr.attr("dataid")],field=$td.attr("name"),value=item[field];self.trigger(e.type==='click'?'click-cell':'dbl-click-cell',field,value,item,$td);self.trigger(e.type==='click'?'click-row':'dbl-click-row',item,$tr,field);if(self.hasSelectItem){var $ipt=$tr.find("input[name='select_item']");var _ipt_val=$ipt.val();if($ipt.attr("type")=="radio"){self.selectedDataIdsManager(_ipt_val)}else{if($ipt.prop('checked')){self.selectedDataIdsManager(_ipt_val,true,false)}else{self.selectedDataIdsManager(_ipt_val,true,true)}}}});self.$el.parent().parent().find("tbody").find("tr").find(":first-child").find("input[type='checkbox']").off('click dblclick');self.$el.parent().parent().find("tbody").find("tr").find(":first-child").find("input[type='checkbox']").change(function(){self.selectedDataIdsManager($(this).val(),true,$(this).is(':checked'))});if(self.options.hover){self.$el.parent().parent().find("tbody").on('mouseenter','tr',function(){var othis=$(this),index=othis.index();self.$el.parent().parent().find("tbody").find('tr:eq('+index+')').addClass("treetable-hover")}).on('mouseleave','tr',function(){var othis=$(this),index=othis.index();self.$el.parent().parent().find("tbody").find('tr:eq('+index+')').removeClass("treetable-hover")})}};BootstrapTreeTable.prototype.selectedDataIdsManager=function(itemVal,isCheckbox,isAdd){var self=this;var $ipt=self.$el.find("tbody").find("tr").find(":first-child").find("input[value='"+itemVal+"']");var $leftIpt=null;if(self.hasFixedColumn){$leftIpt=self.$leftBox.find("tbody").find("tr").find(":first-child").find("input[value='"+itemVal+"']")}if(!(isCheckbox)){self.selectedDataIds=[];self.selectedDataIds.push(itemVal);if(self.hasFixedColumn){self.$leftBox.find("tbody").find("tr").removeClass("treetable-selected");$leftIpt.parent().parent().addClass("treetable-selected");$leftIpt.prop('checked',true)}self.$el.find("tbody").find("tr").removeClass("treetable-selected");$ipt.parent().parent().addClass("treetable-selected");$ipt.prop('checked',true)}else{var _index=$.inArray(itemVal,self.selectedDataIds);if(isAdd){if(!(_index>-1)){self.selectedDataIds.push(itemVal);if(self.hasFixedColumn){$leftIpt.parent().parent().addClass("treetable-selected");$leftIpt.prop('checked',true)}$ipt.parent().parent().addClass("treetable-selected");$ipt.prop('checked',true)}}else{if(_index>-1){self.selectedDataIds.splice(_index,1);if(self.hasFixedColumn){$leftIpt.parent().parent().removeClass("treetable-selected");$leftIpt.prop('checked',"")}$ipt.parent().parent().removeClass("treetable-selected");$ipt.prop('checked',"")}}}};BootstrapTreeTable.prototype.registerExpanderEvent=function(){var self=this;self.$el.find("tbody").find("tr").find(".treetable-expander").off('click').on('click',function(){var _isExpanded=$(this).hasClass(self.options.expanderExpandedClass);var _isCollapsed=$(this).hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){var tr=$(this).parent().parent();var dataid=tr.attr("dataid");self.toggleRow(dataid)}});if(self.hasFixedColumn&&self.expandColumnIsFixed){self.$leftBox.find(".treetable-body-box table tbody").find("tr").find(".treetable-expander").off('click').on('click',function(){var _isExpanded=$(this).hasClass(self.options.expanderExpandedClass);var _isCollapsed=$(this).hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){var tr=$(this).parent().parent();var dataid=tr.attr("dataid");self.toggleRow(dataid)}})}};BootstrapTreeTable.prototype.refresh=function(parms){var self=this;self.destroy();if(parms){self.lastAjaxParams=parms}self.init(self.lastAjaxParams)};BootstrapTreeTable.prototype.appendData=function(data){var self=this;$.each(data,function(i,item){var _data=self.data_obj["id_"+item[self.options.id]];var _p_data=self.data_obj["id_"+item[self.options.parentId]];var _c_list=self.data_list["_n_"+item[self.options.parentId]];var row_id="";var p_id="";var _lv=1;var tr;if(_data&&_data.row_id&&_data.row_id!=""){row_id=_data.row_id}if(_p_data){p_id=_p_data.row_id;var _row_id_lastNum=0;if(row_id==""){if(_c_list&&_c_list.length>0){_row_id_lastNum=_c_list.length}row_id=_p_data.row_id+"_"+_row_id_lastNum}else{var _tmp=row_id.split("_");_row_id_lastNum=_tmp[_tmp.length-1]}_lv=_p_data.lv+1;tr=self.renderRow(item,false,_lv,row_id,p_id);var _p_icon=self.$el.find("tr[rid='"+_p_data.row_id+"']").find(".treetable-expander");var _isExpanded=_p_icon.hasClass(self.options.expanderExpandedClass);var _isCollapsed=_p_icon.hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){if(_isExpanded){tr.css("display","table")}}else{_p_icon.addClass(self.options.expanderCollapsedClass)}if(_data){self.$el.find("tr[rid='"+_data.row_id+"']").remove()}if(_row_id_lastNum==0){self.$el.find("tr[rid='"+_p_data.row_id+"']").after(tr)}else{self.$el.find("tr[rid='"+_p_data.row_id+"_"+(_row_id_lastNum-1)+"']").after(tr)}}else{tr=self.renderRow(item,false,_lv,row_id,p_id);if(_data){var $prev=self.$el.find("tr[rid='"+_data.row_id+"']").prev();self.$el.find("tr[rid='"+_data.row_id+"']").remove();$prev.after(tr)}else{var tbody=self.$el.find("tbody");tbody.append(tr)}}item.isShow=true;self.formatData([item])});self.initHiddenColumns();self.frozen();self.autoReSize();self.registerRowEvent();self.registerExpanderEvent()};BootstrapTreeTable.prototype.toggleRow=function(id){var self=this;var _rowData=self.data_obj["id_"+id];var $tr=self.$el.find("tr[rid='"+_rowData.row_id+"']");var row_id=$tr.attr("rid");var $row_expander=$tr.find(".treetable-expander");var _isExpanded=$row_expander.hasClass(self.options.expanderExpandedClass);var _isCollapsed=$row_expander.hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){var _ls=self.$el.find("tbody").find("tr[rid^='"+row_id+"_']");if(_isExpanded){$row_expander.removeClass(self.options.expanderExpandedClass);$row_expander.addClass(self.options.expanderCollapsedClass);if(_ls&&_ls.length>0){$.each(_ls,function(index,item){$(item).css("display","none")})}}else{$row_expander.removeClass(self.options.expanderCollapsedClass);$row_expander.addClass(self.options.expanderExpandedClass);if(_ls&&_ls.length>0){$.each(_ls,function(index,item){var _p_icon=$("tr[rid='"+$(item).attr("pid")+"']").find(".treetable-expander");if(_p_icon.hasClass(self.options.expanderExpandedClass)){$(item).css("display","table")}})}}if(self.hasFixedColumn){var $left_tr=self.$leftBox.find("tr[rid='"+_rowData.row_id+"']");var _left_ls=self.$leftBox.find(".treetable-body-box table tbody").find("tr[rid^='"+row_id+"_']");if(_isExpanded){if(_left_ls&&_left_ls.length>0){$.each(_left_ls,function(index,item){$(item).css("display","none")})}}else{if(_left_ls&&_left_ls.length>0){$.each(_left_ls,function(index,item){var _p_icon=$("tr[rid='"+$(item).attr("pid")+"']").find(".treetable-expander");if(_p_icon.hasClass(self.options.expanderExpandedClass)){$(item).css("display","table")}})}}if(self.expandColumnIsFixed){var $left_row_expander=$left_tr.find(".treetable-expander");if(_isExpanded){$left_row_expander.removeClass(self.options.expanderExpandedClass);$left_row_expander.addClass(self.options.expanderCollapsedClass)}else{$left_row_expander.removeClass(self.options.expanderCollapsedClass);$left_row_expander.addClass(self.options.expanderExpandedClass)}}}self.autoReSize()}};BootstrapTreeTable.prototype.expandRow=function(id){var self=this;var _rowData=self.data_obj["id_"+id];var $tr=self.$el.find("tr[rid='"+_rowData.row_id+"']");var $row_expander=$tr.find(".treetable-expander");var _isExpanded=$row_expander.hasClass(self.options.expanderExpandedClass);var _isCollapsed=$row_expander.hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){if(_isCollapsed){self.toggleRow(id)}}};BootstrapTreeTable.prototype.collapseRow=function(id){var self=this;var _rowData=self.data_obj["id_"+id];var $tr=self.$el.find("tr[rid='"+_rowData.row_id+"']");var $row_expander=$tr.find(".treetable-expander");var _isExpanded=$row_expander.hasClass(self.options.expanderExpandedClass);var _isCollapsed=$row_expander.hasClass(self.options.expanderCollapsedClass);if(_isExpanded||_isCollapsed){if(_isExpanded){self.toggleRow(id)}}};BootstrapTreeTable.prototype.expandAll=function(){var self=this;if(self.hasFixedColumn&&self.expandColumnIsFixed){self.$leftBox.find("tbody").find("tr").find(".treetable-expander").each(function(i,n){var _isCollapsed=$(n).hasClass(self.options.expanderCollapsedClass);if(_isCollapsed){var $tr=$(n).parent().parent();var dataid=$tr.attr("dataid");self.toggleRow(dataid)}})}else{self.$el.find("tbody").find("tr").find(".treetable-expander").each(function(i,n){var _isCollapsed=$(n).hasClass(self.options.expanderCollapsedClass);if(_isCollapsed){var $tr=$(n).parent().parent();var dataid=$tr.attr("dataid");self.toggleRow(dataid)}})}};BootstrapTreeTable.prototype.collapseAll=function(){var self=this;if(self.hasFixedColumn&&self.expandColumnIsFixed){self.$leftBox.find("tbody").find("tr").find(".treetable-expander").each(function(i,n){var _isExpanded=$(n).hasClass(self.options.expanderExpandedClass);if(_isExpanded){var $tr=$(n).parent().parent();var dataid=$tr.attr("dataid");self.toggleRow(dataid)}})}else{self.$el.find("tbody").find("tr").find(".treetable-expander").each(function(i,n){var _isExpanded=$(n).hasClass(self.options.expanderExpandedClass);if(_isExpanded){var $tr=$(n).parent().parent();var dataid=$tr.attr("dataid");self.toggleRow(dataid)}})}};BootstrapTreeTable.prototype.showColumn=function(field){var self=this;$.each(self.leftFixedColumns,function(i,column){if(column.field==field){return}});var _index=$.inArray(field,self.hiddenColumns);if(_index>-1){self.hiddenColumns.splice(_index,1)}self.$el.parent().parent().find("."+field+"_cls").show();if(self.options.showColumns){var $input=$(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+field+"']");$input.prop("checked",'checked')}self.autoReSize()};BootstrapTreeTable.prototype.hideColumn=function(field){var self=this;$.each(self.leftFixedColumns,function(i,column){if(column.field==field){return}});self.hiddenColumns.push(field);self.$el.parent().parent().find("."+field+"_cls").hide();if(self.options.showColumns){var $input=$(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+field+"']");$input.prop("checked",'')}self.autoReSize()};BootstrapTreeTable.prototype.getSelections=function(){var self=this;if(self.selectedDataIds){var chk_value=[];$.each(self.selectedDataIds,function(i,id){var _data=self.data_obj["id_"+id];chk_value.push(_data)});return chk_value}return};BootstrapTreeTable.prototype.trigger=function(name){var self=this;var args=Array.prototype.slice.call(arguments,1);name+='.bs.tree.table';self.options[BootstrapTreeTable.EVENTS[name]].apply(self.options,args);self.$el.trigger($.Event(name),args);self.options.onAll(name,args);self.$el.trigger($.Event('all.bs.tree.table'),[name,args])};BootstrapTreeTable.prototype.destroy=function(){var self=this;var $container=self.$el.parent().parent().parent();self.$el.insertBefore($container);$(self.options.toolbar).insertBefore(self.$el);self.$el.html(self.$el_.html());$container.remove();self.$headerBox=null;self.$leftBox=null;self.selectedDataIds=[];self.hiddenColumns=[];self.leftFixedColumns=[];self.noFixedColumns=[];self.data_list=null;self.data_obj=null;self.lastAjaxParams=null;self.hasSelectItem=false;self.expandColumnIsFixed=false;self.hasFixedColumn=false};BootstrapTreeTable.METHODS=["getSelections","refresh","appendData","toggleRow","expandRow","collapseRow","expandAll","collapseAll","showColumn","hideColumn","destroy"];BootstrapTreeTable.EVENTS={'all.bs.tree.table':'onAll','click-cell.bs.tree.table':'onClickCell','dbl-click-cell.bs.tree.table':'onDblClickCell','click-row.bs.tree.table':'onClickRow','dbl-click-row.bs.tree.table':'onDblClickRow','load-success.bs.tree.table':'onLoadSuccess','load-error.bs.tree.table':'onLoadError'};BootstrapTreeTable.DEFAULTS={id:'id',parentId:'parentId',rootIdValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:false,expandFirst:true,striped:false,bordered:true,hover:true,condensed:false,columns:[],toolbar:null,width:0,height:0,showTitle:true,showColumns:true,showRefresh:true,expanderExpandedClass:'bstt-icon bstt-chevron-down',expanderCollapsedClass:'bstt-icon bstt-chevron-right',toolRefreshClass:'bstt-icon bstt-refresh',toolColumnsClass:'bstt-icon bstt-columns',onAll:function(data){return false},onLoadSuccess:function(data){return false},onLoadError:function(status){return false},onClickCell:function(field,value,row,$element){return false},onDblClickCell:function(field,value,row,$element){return false},onClickRow:function(row,$element){return false},onDblClickRow:function(row,$element){return false}};BootstrapTreeTable.COLUMN_DEFAULTS={radio:false,checkbox:false,field:undefined,title:undefined,align:undefined,valign:undefined,width:undefined,visible:true,fixed:undefined,formatter:undefined};$.fn.bootstrapTreeTable=function(option){var value,args=Array.prototype.slice.call(arguments,1);this.each(function(){var $this=$(this),data=$this.data('bootstrap.tree.table'),options=$.extend({},BootstrapTreeTable.DEFAULTS,$this.data(),typeof option==='object'&&option);if(typeof option==='string'){if($.inArray(option,BootstrapTreeTable.METHODS)<0){throw new Error("Unknown method: "+option);}if(!data){return}value=data[option].apply(data,args);if(option==='destroy'){$this.removeData('bootstrap.tree.table')}}if(!data){$this.data('bootstrap.tree.table',(data=new BootstrapTreeTable(this,options)))}});return typeof value==='undefined'?this:value}})(jQuery);